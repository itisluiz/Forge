<app-navbar></app-navbar>
<div class="user-story-page-content">
	<ng-container *ngIf="userStory$ | async as userStory">
		<div class="grid-container">
			<div class="header-grid">
				<div class="breadcrump-story-wrapper">
					<ul class="breadcrumber">
						<li><a href="">Squad BES</a></li>
						<div class="spacer">></div>
						<li><a href="">TCC 1</a></li>
						<div class="spacer">></div>
						<li><a href="/user-story">User Story</a></li>
					</ul>
					<h1 id="user-story-title">[{{ userStory.code }}] {{ userStory.title }}</h1>

					<div class="buttons-header">
						<button id="button-edit-page" class="grey-button" (click)="openPopUpEditUserStory()">Edit User Story</button>
						<button mat-icon-button class="mat-icon-button">
							<mat-icon>more_vert</mat-icon>
						</button>
					</div>
				</div>

				<p>{{ userStory.description }}</p>
				<hr />
			</div>

			<div class="user-story-container">
				<div class="story-description story-topic">
					<h4>USER STORY</h4>
					<p><span>As</span> {{ userStory.storyActor }},</p>
					<p><span>I want</span> {{ userStory.storyObjective }}</p>
					<p><span>So that</span> {{ userStory.storyJustification }}.</p>
				</div>
				<div class="business-narrative story-topic">
					<h4>BUSINESS NARRATIVE</h4>
					<p>
						{{ userStory.narrative }}
					</p>
				</div>

				<div class="premises story-topic">
					<h4>PREMISES</h4>
					{{ userStory.premisse }}

					<!-- <div class="premise">
						<p>
							<span class="premise-title">Usability Testing:</span> Rigorous testing will be conducted to validate the menu's
							usability and effectiveness before deployment.
						</p>
					</div>
					<div class="premise">
						<p>
							<span class="premise-title">Continuous Improvement:</span> Feedback mechanisms will be implemented post-launch
							for iterative improvements based on user input and preferences.
						</p>
					</div> -->
				</div>

				<ng-container *ngIf="acceptanceCriteria$ | async as acceptanceCriteria">
					<div class="criteria story-topic">
						<h4>ACCEPTANCE CRITERIA</h4>

						@for (criteria of acceptanceCriteria.acceptanceCriteria; track $index) {
							<div class="criteria-wrapper">
								<p>{{ criteria.given }}</p>
								<p>{{ criteria.when }}</p>
								<p>{{ criteria.then }}</p>
							</div>
						}
					</div>
				</ng-container>

				<div class="test-cases story-topic">
					<h4>TEST CASES</h4>
					@if (testCases.length > 0) {
						<table mat-table [dataSource]="testCases" matSort class="mat-elevation-z8 test-case-table">
							<ng-container matColumnDef="key">
								<th mat-header-cell *matHeaderCellDef>Key</th>
								<td class="item-cell" mat-cell *matCellDef="let element">{{ element.key }}</td>
							</ng-container>

							<ng-container matColumnDef="description">
								<th mat-header-cell *matHeaderCellDef>Subject</th>
								<td mat-cell *matCellDef="let element">{{ element.description }}</td>
							</ng-container>

							<ng-container matColumnDef="link">
								<th mat-header-cell *matHeaderCellDef>Link</th>
								<td mat-cell *matCellDef="let element">
									<a href="/user-story">
										<img src="../../../../../assets/link-icon.svg" />
									</a>
								</td>
							</ng-container>

							<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
						</table>
						<div class="test-case-buttons">
							<button id="button-create-test-manually" class="grey-button" (click)="openPopUp()">Create test case</button>
						</div>
					} @else {
						<div class="no-test-cases-available">
							<p>
								It seems that you have not created any test cases. To generate them manually or automatically, click the
								button below.
							</p>

							<div class="test-case-buttons">
								<button id="button-create-test-manually" class="grey-button" (click)="openPopUp()">Create test case</button>
							</div>
						</div>
					}
				</div>
			</div>
		</div>
	</ng-container>
</div>

@if (popUpActive) {
	<div class="pop-up-background" (click)="closePopUp()"></div>

	<app-test-case-popup [acceptanceCriteria]="acceptanceCriteria" (closePopUpEmitter)="closePopUp()"> </app-test-case-popup>
}

@if (popUpEditUserStory) {
	<div class="pop-up-background" (click)="closePopUpEditUserStory()"></div>

	<app-user-story-popup
		[isEditMode]="true"
		[projectEid]="projectEid"
		(closePopUpEmitter)="closePopUpEditUserStory()"
		(handleEditedUserStoryAndClosePopupEmitter)="setUpdatedUserStory()"
		[userStoryEditData$]="userStory$"
		[criteriaEditData$]="acceptanceCriteria$"
	>
	</app-user-story-popup>
}
